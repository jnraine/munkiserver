<% content_for :sidebar do %>
	<%= recent_packages %>
	<%= available_updates %>
<% end %>

<h2>Listing packages</h2>
<p id="environment_links">
	|
	<% Environment.all.each do |env| %>
		<% if current_environment.id == env.id %>
			<%= env.to_s + " (#{Package.where(:unit_id => current_unit.id, :environment_id => env.id).count})" %>
		<% else %>
			<%= link_to env.to_s + " (#{Package.where(:unit_id => current_unit.id, :environment_id => env.id).count})", packages_path(current_unit, :eid => env.id) %>
		<% end %>
		|
	<% end %>
</p>

<h3><%= current_environment %></h3>

	<% if @packages.length == 0 %>
		<h5>There are no packages in the <%= current_environment.to_s.downcase %> environment</h5>
		<% if can? :create, Package.new_for_can(current_unit) %>
			<p>Why don't you <%= link_to "upload a package", new_package_path %> or two?</p>
		<% end %>
	<% else %>
	<%= form_tag batch_action_packages_path, :method => :get, :id => "package_batch_action", :remote => true do %>
		<p>
		  <%= record_count(@packages) %>
		  <div class="batch_actions">
  		  <%= link_to content_tag(:span, "Batch Actions"), "#batch_action_popover", :id => "batch_action_button", :class => "batch_action_dropdown button" %>
  		  <div class="batch_actions_menu">
  		    <div class="batch_actions_list">
            <%= link_to "Edit Selection", "#", { :remote => true, :class => "batch_action", :id => "edit" } %>
            <%= link_to "Delete Selection", "#", { :remote => true, :class => "batch_action", :id => "delete" } %>
          </div>
        </div>
      </div>
    </p>
		<%= package_table(@packages) %>
	<% end %>

<% end %>